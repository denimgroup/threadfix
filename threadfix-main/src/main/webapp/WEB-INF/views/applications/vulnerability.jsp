<%@ include file="/common/taglibs.jsp"%>

<head>
    <title>Vulnerability Details</title>
    <cbs:cachebustscript src="/scripts/vulnerability-detail-page-controller.js"/>
    <cbs:cachebustscript src="/scripts/document-form-controller.js"/>
    <cbs:cachebustscript src="/scripts/upload-scan-controller.js"/>
    <cbs:cachebustscript src="/scripts/modal-controller-with-config.js"/>
    <cbs:cachebustscript src="/scripts/defect-submission-modal-controller.js"/>
    <cbs:cachebustscript src="/scripts/add-to-existing-defect-controller.js"/>
    <cbs:cachebustscript src="/scripts/grc-control-submission-modal-controller.js"/>
    <cbs:cachebustscript src="/scripts/modal-controller-with-config.js"/>
    <cbs:cachebustscript src="/scripts/vuln-operations-controller.js"/>
</head>

<body id="apps" class="vulnDetails" ng-controller="VulnerabilityDetailPageController" ng-init="isShowInfo = false; toggleBtnText = 'Toggle More Info'">
<%@ include file="/WEB-INF/views/angular-init.jspf"%>
<%@ include file="/WEB-INF/views/applications/forms/vulnCommentForm.jsp"%>
<%@ include file="/WEB-INF/views/applications/forms/vulnTaggingForm.jsp"%>
<%@ include file="/WEB-INF/views/applications/forms/uploadDocForm.jsp" %>
<%@ include file="/WEB-INF/views/defects/submitDefectForm.jsp" %>
<%@ include file="/WEB-INF/views/applications/modals/submitGRCControl.jsp" %>
<%@ include file="/WEB-INF/views/defects/addToExistingDefectForm.jsp" %>

<spring:url value="/organizations/{orgId}" var="teamUrl">
    <spring:param name="orgId" value="${ vulnerability.application.organization.id }" />
</spring:url>
<spring:url value="/organizations/{orgId}/applications/{applicationId}" var="applicationUrl">
    <spring:param name="orgId" value="${ vulnerability.application.organization.id }" />
    <spring:param name="applicationId" value="${ vulnerability.application.id }" />
</spring:url>
<spring:url value="/organizations/{orgId}/applications/{applicationId}/vulnerabilities/{nextVulnId}/batch/{batchIds}/{nextRank}" var="nextVulnBatchUrl">
    <spring:param name="orgId" value="${ nextVuln.application.organization.id }" />
    <spring:param name="applicationId" value="${ nextVuln.application.id }" />
    <spring:param name="nextVulnId" value="${ nextVuln.id }" />
    <spring:param name="batchIds" value="${ batchIds }" />
    <spring:param name="nextRank" value="${ currentRank + 1 }" />
    <spring:param name="numBatchVulns" value="${ numBatchVulns }" />
</spring:url>
<spring:url value="/organizations/{orgId}/applications/{applicationId}/vulnerabilities/{previousVulnId}/batch/{batchIds}/{nextRank}" var="previousVulnBatchUrl">
    <spring:param name="orgId" value="${ previousVuln.application.organization.id }" />
    <spring:param name="applicationId" value="${ previousVuln.application.id }" />
    <spring:param name="previousVulnId" value="${ previousVuln.id }" />
    <spring:param name="batchIds" value="${ batchIds }" />
    <spring:param name="nextRank" value="${ currentRank - 1 }" />
    <spring:param name="numBatchVulns" value="${ numBatchVulns }" />
</spring:url>

<ul class="breadcrumb">
    <li><a href="<spring:url value="/teams"/>">Applications Index</a> <span class="divider">/</span></li>
    <li><a ng-non-bindable href="${ fn:escapeXml(teamUrl) }">Team: <c:out value="${ vulnerability.application.organization.name }"/></a> <span class="divider">/</span></li>
    <li><a ng-non-bindable href="${ fn:escapeXml(applicationUrl) }">Application: <c:out value="${ vulnerability.application.name }"/></a> <span class="divider">/</span></li>
    <li class="active">Vulnerability {{ vulnId }}</li>
</ul>

<c:if test="${not empty batchIds}">
    <ul class="breadcrumb" style="margin-top:-25px">
        <li>Batch reviewing: ${ currentRank } / ${ numBatchVulns }</li>
        <li style="margin-left: 10px">
            <c:if test="${not empty previousVuln}"><a href="${ fn:escapeXml(previousVulnBatchUrl) }">Previous</a></c:if>
            <c:if test="${empty previousVuln}"><span style="color:dimgray">Previous</span></c:if>
        </li>
        <li style="margin: 0 3px 0 3px">-</li>
        <li>
            <c:if test="${not empty nextVuln}"><a href="${ fn:escapeXml(nextVulnBatchUrl) }">Next</a></c:if>
            <c:if test="${empty nextVuln}"><span style="color:dimgray">Next</span></c:if>
        </li>
     </ul>
</c:if>

<c:if test="${not isEnterprise}">
    <%@ include file="/WEB-INF/views/applications/vulnDetailTab.jsp" %>
</c:if>

<c:if test="${isEnterprise}">
    <tabset>
        <tab id="vulnDetailTab" heading="Details">
            <%@ include file="/WEB-INF/views/applications/vulnDetailTab.jsp" %>
        </tab>
        <%@ include file="/WEB-INF/views/config/sharedVulnerability/sharedVulnsTab.jsp" %>
    </tabset>
</c:if>

</body>